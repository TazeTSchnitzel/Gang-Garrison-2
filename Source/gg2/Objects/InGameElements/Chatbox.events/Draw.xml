<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="DRAW" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">var xsize, ysize;

if hidden exit;

xsize = sprite_width;
ysize = sprite_height;

x = view_xview[0] + 45;
y = view_yview[0] + view_hview[0]-sprite_height-85;

draw_set_valign(fa_top);
draw_set_halign(fa_left);
draw_set_color(c_white);

if isTyping
{
    image_alpha = 1;
}
else
{
    image_alpha = max(alarm[1]/30, 0.2);
}
draw_set_alpha(image_alpha);

// Draw the background
draw_sprite(sprite_index, 0, x, y);

// If we're typing something, draw that
if isTyping
{
    var str;
    if blinking_underscore 
    {
        str = keyboard_string+"_";
    }
    else
    {
        str = keyboard_string;
    }
    str = string_replace_all(str,"#","\#")
    draw_set_alpha(1)
    draw_text(x+60, y+ysize-13, str);
    if (isTyping = CHAT_PRIV_MESSAGE)
        draw_text(x+10, y+ysize-13, "(TEAM)");
    if (isTyping = CHAT_PUBLIC_MESSAGE)
        draw_text(x+10, y+ysize-13, "(ALL)");
}

var message, shortMessage, color, offset, drawn_text;
draw_set_font(global.gg2Font)

var message, x_offset;
for(i=0; i&lt;ds_list_size(chatLog); i+=1)
{
    message = ds_list_find_value(chatLog, i)
    x_offset = 0;

    while string_count("/:/", message) &gt; 0
    {
        var nextpos, text;
        // Get the color from the prefix
        draw_set_color(getColorCode(string_copy(message, 4, COLOR_RGB_LENGTH)));
        // Check if there's another prefix in this message
        nextpos = string_pos("/:/", string_copy(message, 4, string_length(message))) + 3;
        if nextpos == 3
        {
            // There isn't an color code in the future, we can draw everything
            text = string_copy(message, 4+COLOR_RGB_LENGTH, string_length(message));
            message = "";
        }
        else
        {
            // There is another, crop to it
            // What we'll draw this time
            text = string_copy(message, 4+COLOR_RGB_LENGTH, nextpos-COLOR_RGB_LENGTH-4);
            // What we need to set with a new color
            message = string_copy(message, nextpos, string_length(message));
        }
        draw_text(x+x_offset+10, y+ysize-45-12*(ds_list_size(chatLog)-i), text);
        // Offset the draw pos of the next strip of text, so that it doesn't overwrite the old one
        x_offset += string_width(text);
    }
}

draw_set_font(global.gg2Font)
draw_set_color(c_white);
</argument>
      </arguments>
    </action>
  </actions>
</event>
